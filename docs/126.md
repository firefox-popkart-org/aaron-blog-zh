# 重写 Reddit

> 原文：<http://www.aaronsw.com/weblog/rewritingreddit>

**翻译：** [塞尔维亚-克罗地亚语](http://science.webhostinggeeks.com/ponovno-pisanje-reddit)

*2012 注:本文首次发表于 2005 年。发表后，姜戈发起了一个 RemovingTheMagic 项目来解决我的一些批评(尽管我个人仍然觉得它不可用)， [web.py](http://webpy.org/) 激发了 FriendFeed 的 [tornado.web](http://www.tornadoweb.org/) 和谷歌的 [gae.webapp](https://developers.google.com/appengine/docs/python/gettingstarted/usingwebapp) 和其他(尽管我仍然更喜欢 web.py)，这篇文章导致了 Reddit 流量的永久激增，但仍然没有真正停止增长。*

[![reddit mascot](img/b3606934ccffbc2fe0f54847fd19145d.png)](http://reddit.com/)

在 reddit.com，我们在过去的一周内将网站从 Lisp 改写为 Python。几乎是在一个周末完成的。(爆料:我们使用了我的[网络版](http://webpy.org/)图书馆。)其他人知道 Lisp(他们在里面写了他们的整个网站)和 Python(他们在里面重写了他们的整个网站)，但是他们决定更喜欢 Python 来做这个项目。Python 版本的代码更少，运行速度更快，更容易阅读和维护。

从红迪博客上的评论[来看，有比 Lisp 更好的东西的想法对一些人来说显然是不可思议的。相反，利斯派斯很快开始试图找到开关背后的真正原因*。*](http://reddit.com/blog/2005/12/night-of-living-python.html)

有人认为这一定是上帝的干预，因为“似乎没有其他理由转向一种低劣的语言。”另一个人认为一定发生了其他事情:“这可能是……一个谎言吗？为了摆脱竞争？保罗·格拉厄姆并不是没有在他的文章中暗示过这种策略……”另一个人插话说:“我认为这是一个恶作剧。”另一个人认为作者只是想要更多的“偷工减料、黑客攻击和伪造的艺术作品”。

当然，这些都是极端情况。其他人认为一定有外部压力。“我猜要么是图书馆，要么是雇佣新的程序员。”另一个人总结道:“一些 vc 套装想要一个可维护的程序员产品。我希望他付给你几百万。”

Lisp 新闻组`comp.lang.lisp`对他们目前计划将*写一个竞争对手*到 Lisp 的 reddit 的转换感到不安，以显示他们有多正确。

更理智的人认为 Lisp 的价值在于能够创建新的语言结构，对于简单的网络应用程序来说，这是不必要的，因为这些结构已经构建好了。但即使这样也不是真的。 [web.py](http://webpy.org/) 几乎是从零开始构建的，它使用了各种“新的语言结构”，而且——更好的是——这些结构有与之相适应的语法，使它们具有合理的可读性。当然，Python 不是 Perl 6，所以您不能添加任意语法，但是您通常可以找到一种聪明的方法来完成这项工作。

* * *

另一方面，Python 也有自己的问题。最大的是它有几十个 web 应用程序框架，但是没有一个是好的。Python 爱好者非常了解第一部分，但显然不了解第二部分，因为当我告诉他们我正在使用自己的库时，普遍的反应是“我认为 Python 不需要另一个 web 应用程序框架”。是的，Python 需要更少的网络应用框架。但也需要一个不烂的。

看起来最有希望的框架是 [Django](http://djangoproject.com/) ，事实上我们最初试图在其中重写 Reddit。作为最有经验的 Python 程序员，我尽力帮助其他人。

Django 从外表上看似乎很棒:一个好看的网站，聪明而有才华的开发人员，以及看起来过剩的好功能。开发人员和社区对补丁和建议非常有帮助和响应。所有正确的目标都体现在他们的哲学文件和常见问题解答中。然而不幸的是，他们似乎完全没有能力实现这些目标。

虽然 Django 声称它是“松散耦合的”，但使用它几乎需要将您的代码融入 Django 的世界观。Django 坚持自己执行代码，要么通过它的命令行实用程序，要么通过用适当的环境变量和 Python 路径调用的专用服务器处理程序。当您启动一个项目时，默认情况下，Django 会为您的代码创建嵌套四层的文件夹，虽然您可以移动一些文件，但我很难弄清楚是哪些文件以及如何移动的。

Django 的哲学说“显性比隐性好”，但是 Django 有各种各样的魔力。您在一个文件中创建的数据库模型神奇地出现在 Django 模块深处的其他地方，并具有不同的名称。当你的模型函数被调用时，新的东西被添加到它的变量空间，旧的被移除。(不过，我听说他们目前正在修复这两个问题。)

Django 的另一个目标是“更少的代码”，至少对你来说是这样。但是 Django 只是充满了代码。django 模块中有 10 个不同的文件夹，每个文件夹中还有几个。当您在姜戈教程中实际构建站点时，您已经导入了`django.core.meta`、`django.models.polls`、`django.conf.urls.defaults.*`、`django.utils.httpwrappers.HttpResponse`和`django.core.extensions.render_to_response`。目前还不清楚人们应该如何记住所有这些，尤其是因为似乎没有指导原则去哪里或如何命名。其中三个是由启动脚本自动插入的，但是您仍然需要记住您想要使用的其他函数的名称。

但是 Django 最重要的问题是它的开发者似乎没有能力设计一个像样的 API。他们显然是有能力的 Python 程序员——他们的代码使用了各种奇怪的技巧。他们显然能够编写有效的代码——他们有各种有趣的特性。但是他们似乎不能把这段代码塑造成其他人可以使用的东西。

他们的 API 很难看，而且经常缺少关键特性:数据库 API 通过计算下划线来计算查询，但没有 JOINs 的特殊语法，模板系统要求每个变量周围有四个大括号，并且不能进行任何类型的计算，表单 API 需要 15 行来处理表单，并且不能自动生成模板。

我尽了最大努力来解决问题——姜戈社区非常支持我——但是这个任务让我相形见绌。我只是在精神上做不到，更不用说时间限制了，我不得不为自己的创业公司构建自己的应用程序。

* * *

所以，Lisp 和 Django 发现了不足，我们只剩下 [web.py](http://webpy.org/) 。我想说的是，web.py 从这些错误中吸取了教训，并被设计来避免这些错误，但事实是，web.py 早在这一切发生之前就已经写好了，并且设法避免了这些错误。

我写 web.py 的方式很简单:我想象事情应该如何运作，然后我让它发生。有时候让事情正常运转需要大量的代码。有时候只需要一点点。但是不管怎样，这个事实对用户是隐藏的——他们只是得到了理想的应用编程接口。

那么事情应该如何运作呢？第一个原则是代码应该清晰简单。如果你想输出一些文本，你叫 web.output。如果你想得到表单输入，你叫 web.input。没有什么特别难记的。

第二个原则是 web.py 应该适合您的代码，而不是相反。web.py 中的每个功能都是完全独立的，你可以使用任何你想要的功能。你可以把你的文件放在任何你喜欢的地方，web.py 会很乐意跟着你。如果你想让一段代码作为 web 应用程序运行，你称之为 web.run，你不会把你的代码放在神奇的地方，这样 web.py 就可以运行你。

第三个原则是，默认情况下，web.py 应该通过 web 做正确的事情。这意味着正确区分 GET 和 POST。它意味着同义词重定向到的简单、规范的 URL。这意味着可读的超文本标记语言，带有适当的 HTTP 头。

就我而言，这几乎是你需要的所有原则。对我来说，它们看起来非常简单和明显，我甚至愿意对其中一些进行篡改，但似乎没有其他 Python 网络应用程序框架能与之媲美。(如果你知道一个，告诉我，我很乐意放弃。我不想干这行。)在那之前，看起来我不得不做一件我宁愿不做的可怕的事情:向世界再发布一个 Python web 应用程序框架。

你应该在推特上关注我这里。

2005 年 12 月 6 日